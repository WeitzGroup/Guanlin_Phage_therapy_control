How to generate the figures: 

Fig. 2
Run "fig_1D_OC_phage_decay.m"
This script plots data written in txt files in the local folder generated by the system_analysis m.files (in both 1D_OC and 2D_OC subfolders), which is time consuming to run.
Description: Minimal  phage  amount  for  eliminating  bacterial  cells  using  1D-OC  strategy  (green  dots).  There  is  no  1D-OC treatment that can eliminate bacteria in the regime of high phage decay rate. Two 1D-OC examples are provided in Fig. 3: the corresponding time series of population densities and injection rate trajectories. See model parameters and simulation details in Sect. 4.2

Fig. 3A
Run "1D_OC\fig_1DOC_PhageDecay_sim.m" with setting sim_case = 1
Fig. 3B
Run 1D_OC\fig_1DOC_PhageDecay_sim.m with setting sim_case = 2
Description: Time series of population densities and optimal injection rates of two 1D-OC examples (labeled in Fig. 2): (A) slow phage decay and (B) fast phage decay.

Fig. 4
Run "fig_2D_OC_immune.m"
This script plots data written in txt files in the local folder generated by the system_analysis m.files (in both 1D_OC and 2D_OC subfolders), which is time consuming to run.
Description: Minimal phage amount for eliminating bacterial cells using 2D-OC strategy (left) and the practical therapeutic treatment (right). (Left) Minimal phage amount for eliminating bacterial cells using 2D-OC strategy (red) and practical therapeutic treatment guided by 2D-OC strategy (green).

Fig. 5A
Run "1D_OC\fig_1DOC_ImmuneLevel_sim.m" on setting sim_case=1
Fig. 5B and 5C
Run "2D_OC\fig_2DOC_ImmuneLevel_sim.m" on setting sim_case=1
Comparison of time series of population densities with different treatments with high level of baseline immune response,
(A) 1D-OC treatment, (B) 2D-OC treatment, and (C) practical treatment.

Fig. 6A
Run "1D_OC\fig_1DOC_ImmuneLevel_sim.m" on setting sim_case=2
Fig. 6B and 6C
Run "2D_OC\fig_2DOC_ImmuneLevel_sim.m" on setting sim_case=2
Comparison of time series of population densities with different treatments with low level of baseline immune response,
(A) 1D-OC treatment, (B) 2D-OC treatment, and (C) practical treatment.

Fig. S1A
Run "1D_OC\fig_1DOC_ImmuneLevel_sim.m" on setting sim_case=3
Fig. S1B and S1C
Run "2D_OC\fig_2DOC_ImmuneLevel_sim.m" on setting sim_case=3
Comparison of time series of population densities with different treatments with very high level of baseline immune response,
(A) 1D-OC treatment, (B) 2D-OC treatment, and (C) practical treatment.

Description of scripts in different folders: 

Folder - 1D_OC:
A. Scripts associated with implementation of Hamiltonian-based algorithm: 
1. cost_obj: cost functional
2. adjODE: adjoint system 
3. costate_solver: solve adjoint(co-)system backward in time via Backward Euler
4. Hamiltonian: Hamiltonian in time
5. Jacobian_mat: Jacobian matrix of ode system
6. optimal_u: update u_k in Hamiltonian-based algorithm via optimality system derived. 
7. rpsODE: ode system of model
8. state_solver: solving ode system forward in time via Forward Euler. 
9(optional). converge_control_figure: plots of convergence performance of algorithm. 

B. System analysis:
1. index_bacteria_elimination.m: find the index of time that bacteria is eliminated
2. sys_analysis_1DOC_phage_decay.m + treatment_1D_OC.m: system analysis of 1DOC on phage decay rate and find the minimal dosage via tune regulator weight. Run sys_analysis_1DOC_phage_decay.m to generate data file as input for fig_1D_OC_phage_decay.m

C. Figures:
1. fig_1DOC_ImmuneLevel_sim.m: population time series via optimal control with different initial immune level in immunodeficient hosts
1. fig_1DOC_PhageDecay_sim.m: population time series via optimal control with different phage decay rate in normal immune hosts.

Folder - 2D_OC:
A. Scripts associated with implementation of Hamiltonian-based algorithm are similar as in 1D_OC case.

B. System analysis:
1. sys_analysis_2DOC_immune_level + phage_therapy_OC.m + treatment_2D_OC.m + sys_summary_heuristic_SDs_immnue_level.m: system analysis of 2DOC on different initial immune response and find the minimal dosage via tuning regulator weight. Run sys_analysis_2DOC_immune_level and sys_summary_heuristic_SDs_immnue_level.m to generate data files, then integrate these data files together as input data file for fig_2D_OC_immune.m
2. practical_injection_data.m: extract timing and composition information from 2DOC injection rates.
3. practical_multi_SDs_solver.m + pseudo_practical_process.m + treatment_practical_multi_SDs.m: solving in silico practical therapy using multiple single doses, also constantly amplify (if needed) the dosage of phage to make practical treatment work.


C. Figures:
1. fig_2DOC_ImmuneLevel_sim.m: population time series via optimal control with different initial immune level in immunodeficient hosts


